<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40-Day Event Schedule</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* ベーススタイル */
        body { 
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; 
            padding: 10px; 
            background: #f0f2f5; 
            color: #333; 
            margin: 0;
        }
        
        /* 操作パネル */
        .controls { 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
            display: flex; 
            gap: 15px; 
            flex-wrap: wrap; 
            align-items: center; 
            justify-content: center; 
        }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-weight: bold; font-size: 0.85em; color: #666; }
        input, button { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        button { cursor: pointer; background: #007bff; color: white; border: none; transition: 0.2s; }
        button:hover { background: #0056b3; }
        button.download-btn { background: #28a745; }
        button.download-btn:hover { background: #1e7e34; }
        button.active { background: #004494; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }

        /* カレンダー本体 */
        #calendar-container { 
            background: white; 
            padding: 20px; 
            width: 98%; /* 画面幅に合わせて伸縮 */
            max-width: 1400px; /* PCでの最大幅 */
            margin: 0 auto; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
        }

        h2 { text-align: center; margin: 0 0 20px 0; font-size: 24px; color: #444; }

        /* グリッドレイアウト */
        .calendar-wrapper { 
            display: grid;
            grid-template-columns: repeat(7, 1fr); 
            background-color: #ccc; 
            gap: 1px; 
            border: 1px solid #ccc; 
        }
        
        /* 曜日ヘッダー */
        .week-day-name { 
            background: #4a90e2; 
            color: white; 
            text-align: center; 
            font-weight: bold; 
            padding: 8px 0;
            font-size: 0.9em; 
        }

        /* 日付セル */
        .day-cell { 
            background: #fff; 
            min-height: 120px; 
            display: flex; 
            flex-direction: column; 
            position: relative;
            overflow: hidden; 
        }
        
        .day-cell.empty { background: #f9f9f9; }

        /* 日付ヘッダー */
        .date-header { 
            background: #f1f1f1; 
            padding: 3px 5px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-size: 0.95em; 
            border-bottom: 1px solid #eee;
        }
        .day-count { font-weight: bold; color: #555; }
        .date-text { font-weight: bold; }

        .is-sunday .date-text { color: red; }
        .is-saturday .date-text { color: blue; }

        /* 上段：タイトルエリア */
        .schedule-title-area {
            background-color: #e6f3ff;
            padding: 3px;
            font-size: 0.9em; 
            font-weight: bold;
            color: #0056b3;
            border-bottom: 1px dotted #ccc;
            min-height: 1.4em; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.2;
            word-break: break-all;
        }

        /* 下段：内容エリア */
        .schedule-content-area {
            flex-grow: 1; 
            padding: 5px;
            font-size: 0.8em; 
            color: #333;
            white-space: pre-wrap; 
            word-break: break-all; 
            line-height: 1.3;
            text-align: right; 
        }
        
        @media (max-width: 600px) {
            #calendar-container { padding: 5px; width: 100%; }
            .week-day-name { font-size: 0.7em; padding: 5px 0; }
            .day-cell { min-height: 90px; }
            .date-header { font-size: 0.75em; flex-direction: column; align-items: flex-start; }
            .schedule-title-area { font-size: 0.75em; }
            .schedule-content-area { font-size: 0.7em; }
        }

    </style>
</head>
<body>

    <div class="controls" data-html2canvas-ignore="true">
        <div class="control-group">
            <label>Start Date / 開始日 / 开始日期</label>
            <input type="date" id="startDateInput">
        </div>

        <div class="control-group">
            <label>Language / 言語 / 语言</label>
            <div style="display: flex; gap: 5px;">
                <button onclick="setLanguage('ja')" id="btn-ja">日本語</button>
                <button onclick="setLanguage('en')" id="btn-en">English</button>
                <button onclick="setLanguage('zh')" id="btn-zh">中文</button>
            </div>
        </div>

        <div class="control-group" style="margin-left: auto;">
            <label>Export</label>
            <div style="display: flex; gap: 5px;">
                <button class="download-btn" onclick="downloadImage()">PNG</button>
                <button class="download-btn" onclick="downloadPDF()">PDF</button>
            </div>
        </div>
    </div>

    <div id="calendar-container">
        <h2 id="calendar-title">Event Schedule</h2>
        
        <div class="calendar-wrapper" id="calendarGrid">
            </div>
    </div>

    <script>
        // --- 1. スケジュール定義 ---
        const scheduleMap = [
            { start: 1, end: 1, ja: "初出征", en: "First Sortie", zh: "初次出征" },
            { start: 2, end: 3, ja: "協力作業", en: "Cooperation", zh: "协作任务" },
            { start: 4, end: 4, ja: "蟻塚補強", en: "Reinforce Anthill", zh: "加固蚁巢" },
            { start: 5, end: 5, ja: "モンスターハンター", en: "Monster Hunter", zh: "猎杀野怪" },
            { start: 6, end: 7, ja: "密林ハンター、拠点", en: "Jungle Hunter/Base", zh: "丛林猎手/据点" },
            { start: 8, end: 9, ja: "蜂の踊り", en: "Bee Dance", zh: "蜜蜂之舞" },
            { start: 10, end: 13, ja: "探索続け", en: "Keep Exploring", zh: "继续探索" },
            { start: 14, end: 15, ja: "兵隊アリ集合", en: "Gather Soldiers", zh: "集结兵蚁" },
            { start: 16, end: 18, ja: "豊穣の実り", en: "Bountiful Harvest", zh: "丰收之时" },
            { start: 19, end: 21, ja: "天下無双Ⅰ", en: "Unrivaled I", zh: "天下无双 I" },
            { start: 22, end: 25, ja: "奇観占領", en: "Occupy Wonder", zh: "占领奇观" },
            { start: 26, end: 28, ja: "敵陣突撃", en: "Enemy Raid", zh: "突击敌阵" },
            { start: 29, end: 32, ja: "天下無双Ⅱ", en: "Unrivaled II", zh: "天下无双 II" },
            { start: 33, end: 38, ja: "密林征服", en: "Conquer Jungle", zh: "征服丛林" },
            { start: 39, end: 40, ja: "決算", en: "Settlement", zh: "结算" }
        ];

        // --- 2. 内容定義 ---
        const contentOverrides = {
            2: { ja: "雀蜂解放", en: "Unlock Hornet", zh: "解锁胡蜂" },
            4: { ja: "シーズンガチャ\nコロニー＋６\nコロニーレベルアップ９", en: "Season Gacha\nColony +6\nColony LvUp 9", zh: "赛季抽奖\n菌丛 +6\n菌丛升级 9" },
            5: { ja: "T12解放\nカワウソ\nスパイクリザード出現\nコロニー＋６", en: "Unlock T12\nOtter\nSpiked Lizard\nColony +6", zh: "解锁 T12\n水獭\n刺蜥出现\n菌丛 +6" },
            6: { ja: "コロニー＋６", en: "Colony +6", zh: "菌丛 +6" },
            8: { ja: "コロニー＋14\nコロニーレベルアップ11", en: "Colony +14\nColony LvUp 11", zh: "菌丛 +14\n菌丛升级 11" },
            10: { ja: "イチゴエリア解放\n陣営キャンプⅡ\nコロニー＋８", en: "Strawberry Area\nCamp II\nColony +8", zh: "草莓区域解锁\n阵营营地 II\n菌丛 +8" },
            14: { ja: "トンネル５\n監視哨譲渡\n雀蜂lv22,スパリザ45\nコロニー＋８\nコロニーレベルアップ13", en: "Tunnel 5\nTransfer Sentry\nHornet 22, Liz 45\nColony +8\nColony LvUp 13", zh: "隧道 5\n转让哨塔\n胡蜂22, 刺蜥45\n菌丛 +8\n菌丛升级 13" },
            16: { ja: "コロニー＋８", en: "Colony +8", zh: "菌丛 +8" },
            18: { ja: "争覇ランキングⅠ締め切り", en: "Ranking I Deadline", zh: "争霸排名 I 截止" },
            19: { ja: "イチゴエリア終了\nトンネル６\n陣営キャンプⅢ\n雀蜂23", en: "Strawberry End\nTunnel 6\nCamp III\nHornet 23", zh: "草莓区域结束\n隧道 6\n阵营营地 III\n胡蜂 23" },
            22: { ja: "トンネル７\n陣営キャンプⅣ\nカワウソ\nコロニー＋８\nコロニーレベルアップ15", en: "Tunnel 7\nCamp IV\nOtter\nColony +8\nColony LvUp 15", zh: "隧道 7\n阵营营地 IV\n水獭\n菌丛 +8\n菌丛升级 15" },
            25: { ja: "争覇ランキングⅡ締め切り", en: "Ranking II Deadline", zh: "争霸排名 II 截止" },
            26: { ja: "トンネル８\nリス奇観\n奇観粉砕可能\n環境地帯消失", en: "Tunnel 8\nSquirrel Wonder\nSmash Wonder\nEnv Zone Vanish", zh: "隧道 8\n松鼠奇观\n粉碎奇观\n环境带消失" },
            29: { ja: "コロニー＋８", en: "Colony +8", zh: "菌丛 +8" },
            33: { ja: "コロニー＋８", en: "Colony +8", zh: "菌丛 +8" },
            // ★38日目を追加
            38: { ja: "争覇ランキングⅢ締め切り", en: "Ranking III Deadline", zh: "争霸排名 III 截止" }
        };

        // --- データ生成 ---
        const scheduleData = [];
        scheduleMap.forEach(period => {
            for (let d = period.start; d <= period.end; d++) {
                const override = contentOverrides[d] || { ja: "", en: "", zh: "" };
                scheduleData.push({
                    day: d,
                    ja: { title: period.ja, content: override.ja },
                    en: { title: period.en, content: override.en },
                    zh: { title: period.zh, content: override.zh }
                });
            }
        });

        // --- 3. 描画ロジック ---
        let currentLang = 'ja';
        const uiText = {
            ja: { title: "異変密林カレンダー", days: ["月", "火", "水", "木", "金", "土", "日"] },
            en: { title: "Mutated Jangle Calendar", days: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"] },
            zh: { title: "异变密林日历", days: ["一", "二", "三", "四", "五", "六", "日"] }
        };

        const dateInput = document.getElementById('startDateInput');
        const calendarGrid = document.getElementById('calendarGrid');
        const title = document.getElementById('calendar-title');

        dateInput.valueAsDate = new Date();

        function renderCalendar() {
            calendarGrid.innerHTML = "";
            title.innerText = uiText[currentLang].title;

            document.querySelectorAll('button[id^="btn-"]').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${currentLang}`).classList.add('active');

            uiText[currentLang].days.forEach(dayName => {
                const div = document.createElement('div');
                div.className = 'week-day-name';
                div.innerText = dayName;
                calendarGrid.appendChild(div);
            });

            const startDate = new Date(dateInput.value);
            if (!dateInput.value) return;

            let startDayIndex = (startDate.getDay() + 6) % 7;

            for (let i = 0; i < startDayIndex; i++) {
                calendarGrid.appendChild(createEmptyCell());
            }

            scheduleData.forEach((item, index) => {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + index);
                
                const month = currentDate.getMonth() + 1;
                const date = currentDate.getDate();
                const dayOfWeek = currentDate.getDay(); 
                const dateStr = `${month}/${date}`;
                
                const data = item[currentLang] || { title: "", content: "" };

                const cell = document.createElement('div');
                cell.className = 'day-cell';
                if (dayOfWeek === 0) cell.classList.add('is-sunday');
                if (dayOfWeek === 6) cell.classList.add('is-saturday');

                cell.innerHTML = `
                    <div class="date-header">
                        <span class="day-count">Day ${item.day}</span>
                        <span class="date-text">${dateStr}</span>
                    </div>
                    <div class="schedule-title-area">
                        ${data.title}
                    </div>
                    <div class="schedule-content-area">
                        ${data.content}
                    </div>
                `;
                calendarGrid.appendChild(cell);
            });

            const totalCells = startDayIndex + scheduleData.length;
            const remainder = totalCells % 7;
            if (remainder !== 0) {
                for (let i = 0; i < (7 - remainder); i++) {
                    calendarGrid.appendChild(createEmptyCell());
                }
            }
        }

        function createEmptyCell() {
            const div = document.createElement('div');
            div.className = 'day-cell empty';
            return div;
        }

        function setLanguage(lang) {
            currentLang = lang;
            renderCalendar();
        }

        // --- Export ---
        async function captureCanvas() {
            const element = document.getElementById('calendar-container');
            const originalWidth = element.style.width;
            element.style.width = "1200px"; 
            
            const canvas = await html2canvas(element, { scale: 2, useCORS: true });
            
            element.style.width = originalWidth;
            return canvas;
        }

        async function downloadImage() {
            const canvas = await captureCanvas();
            const link = document.createElement('a');
            link.download = `schedule_${dateInput.value}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const canvas = await captureCanvas();
            const imgData = canvas.toDataURL('image/png');
            
            const pdf = new jsPDF('l', 'mm', 'a4');
            const pageWidth = 297; 
            const pageHeight = 210;
            const margin = 10;
            const printableWidth = pageWidth - (margin * 2);
            
            const imgProps = pdf.getImageProperties(imgData);
            const printableHeight = (imgProps.height * printableWidth) / imgProps.width;

            if (printableHeight > pageHeight - (margin * 2)) {
                const ratio = (pageHeight - (margin * 2)) / printableHeight;
                pdf.addImage(imgData, 'PNG', margin, margin, printableWidth * ratio, printableHeight * ratio);
            } else {
                pdf.addImage(imgData, 'PNG', margin, margin, printableWidth, printableHeight);
            }
            
            pdf.save(`schedule_${dateInput.value}.pdf`);
        }

        dateInput.addEventListener('change', renderCalendar);
        window.addEventListener('resize', renderCalendar);
        renderCalendar();

    </script>
</body>

</html>
